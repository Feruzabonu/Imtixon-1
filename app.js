let DATA = {
    users: [
        {
            id: 1,
            first_name: "Onajonim",
            activity: "last seen recently",
            avatar: "./img/onajonim.jpg",
            phone_number: "+998 93 505 12 22",
            bio: "",
            user_name: "",
            photos: 649,
            videos: 34,
            files: 628,
            audio_files: 4,
            shared_links: 145,
            voice_messages: 24, 
            gifs: 6,
            groups_common: 3,
            selected:true,
            messages: [
                {
                    id: 1,
                    is_from_me: true,
                    text: "Assalomu alaykum",
                    time: `12 : 12`,
                },
                {
                    id: 2,
                    is_from_me: false,
                    text: "Vaalaykum assalom",
                    time: `17 : 08`,
                },
            ]  
        },
        {
            id: 2,
            first_name: "Nilufar",
            activity: "last seen recently",
            avatar: "./img/nilufar.jpg",
            phone_number: "+998 94 601 45 54",
            bio: "",
            user_name: "@Karshiyeva_N",
            photos: 85,
            videos: 3,
            files: 36,
            audio_files: 1,
            shared_links: 49,
            voice_messages: 6,
            gifs: 10,
            groups_common: 2,
            selected:false,
            messages: [
                {
                    id: 1,
                    is_from_me: false,
                    text: "Hello",
                    time: `10 : 45`,
                },
                {
                    id: 2,
                    is_from_me: true,
                    text: "Hi",
                    time: `19 : 00`,
                },
            ]  
        },
        {
            id: 3,
            first_name: "Shohida",
            activity: "online",
            avatar: "./img/shohida.jpg",
            phone_number: "+998 99 435 51 53",
            bio: "ÿßŸêŸÜŸëŸé ŸÑŸêŸÑŸëŸéÿ≠Ÿê ŸàÿßŸé ÿßŸêŸÜŸëŸé ÿßŸêŸÑŸéŸäÿ≠Ÿê ÿ±Ÿéÿ¨ŸêÿßŸèŸÜ",
            user_name: "@ShDAShShA",
            photos: 4037,
            videos: 163,
            files: 494,
            audio_files: 45,
            shared_links: 229,
            voice_messages: 4749,
            gifs: 514,
            groups_common: 26,
            selected:false,
            messages: [
                {
                    id: 1,
                    is_from_me: true,
                    text: "Salom)",
                    time: `7 : 09`,
                },
                {
                    id: 2,
                    is_from_me: true,
                    text: "Qalesan?",
                    time: `7 : 09`,
                },
                {
                    id: 3,
                    is_from_me: false,
                    text: "Yaxshi rahmat)",
                    time: `22 : 10`,
                },
                {
                    id: 4,
                    is_from_me: false,
                    text: "O'zin yaxshimisan?",
                    time: `22 : 10`,
                },
            ]  
        },
        {
            id: 4,
            first_name: "Nargiza To'rt",
            activity: "last seen recently",
            avatar: "./img/nargiza_tort.jpg",
            phone_number: "+998 90 371 37 38",
            bio: "",
            user_name: "@Azigrancake",
            photos: 1,
            videos: 0,
            files: 0,
            audio_files: 1,
            shared_links: 0,
            voice_messages: 0,
            gifs: 0,
            groups_common: 1,
            selected:false,
            messages: [
                {
                    id: 1,
                    is_from_me: true,
                    text: "Assalomu alaykum",
                    time: `18 : 09`,
                },
                {
                    id: 2,
                    is_from_me: false,
                    text: "Vaalaykum assalom",
                    time: `18 : 10`,
                },
                {
                    id: 3,
                    is_from_me: true,
                    text: `<img style="width: 150px; height: 150px; display:block;" src='./img/nargiza_tort.jpg'>`,
                    time: `18 : 10`,
                },
                {
                    id: 4,
                    is_from_me: true,
                    text: "Shu to'rt narxi qancha?",
                    time: `18 : 10`,
                },
                {
                    id: 5,
                    is_from_me: false,
                    text: "300 ming so'z",
                    time: `18 : 30`,
                },
                {
                    id: 6,
                    is_from_me: true,
                    text: "Yana qanaqa to'rtlariz bor yaxshi?",
                    time: `20 : 30`,
                },
                {
                    id: 7,
                    is_from_me: false,
                    text:`<img style="width: 150px; height: 150px; display:block;" src='./img/nargiza_tort1.jpg'>`,
                    time: `20 : 50`,
                },
                {
                    id: 8,
                    is_from_me: false,
                    text:`<img style="width: 150px; height: 150px; display:block;" src='./img/nargiza_tort2.jpg'>`,
                    time: `20 : 52`,
                },
                {
                    id: 10,
                    is_from_me: true,
                    text:"Bula qanchadan?",
                    time: `21 : 30`,
                },
                {
                    id: 11,
                    is_from_me: false,
                    text:"200 ming va 300 ming so'm",
                    time: `21 : 48`,
                },
            ]  
        },
        {
            id: 5,
            first_name: "Hilola",
            activity: "Last seen today at 21:38",
            avatar: "./img/hilola.jpg",
            phone_number: "+998 99 833 56 44",
            bio: "üê≥ü§ç",
            user_name: "@bintu_Abdumalik",
            photos: 146,
            videos: 14,
            files: 2,
            audio_files: 5,
            shared_links: 46,
            voice_messages: 260,
            gifs: 24,
            groups_common: 11,
            selected:false,
            messages: [
                {
                    id: 1,
                    is_from_me: false,
                    text: "Assalomu alaykum va Rohmatullohi va barokatuh",
                    time: `12 : 09`,
                },
                {
                    id: 2,
                    is_from_me: true,
                    text: "Vaalaykum assalom va rohmatullohi va barokatuh",
                    time: `19 : 50`,
                },
            ]  
        },
        {
            id: 6,
            first_name: "Ziyoda",
            activity: "Last seen today at 21:03",
            avatar: "./img/ziyoda.jpg",
            phone_number: "+998 99 376 88 24",
            bio: "",
            user_name: "",
            photos: 435,
            videos: 9,
            files: 118,
            audio_files: 0,
            shared_links: 27,
            voice_messages: 264,
            gifs: 11,
            groups_common: 12,
            selected:false,
            messages: [
                {
                    id: 1,
                    is_from_me: true,
                    text: "Tabrikliman ukeni institutga kirgani bilan)",
                    time: `18 : 09`,
                },
                {
                    id: 2,
                    is_from_me: false,
                    text: "Rahmat kottakon))))",
                    time: `18 : 10`,
                },
            ]  
        },
        {
            id: 7,
            first_name: "Shahzoda",
            activity: "Last seen today at 22:17",
            avatar: "./img/shahzoda.jpg",
            phone_number: "+998 97 870 55 88",
            bio: "ÿ•ŸÜÿß ŸÑŸÑŸá Ÿàÿ•ŸÜÿß ÿ•ŸÑŸäŸá ÿ±ÿßÿ¨ÿπŸàŸÜ",
            user_name: "@a_d_7276",
            photos: 51,
            videos: 0,
            files: 13,
            audio_files: 1,
            shared_links: 2,
            voice_messages: 26,
            gifs: 11,
            groups_common: 8,
            selected:false,
            messages: [
                {
                    id: 1,
                    is_from_me: true,
                    text: "Salom",
                    time: `18 : 09`,
                },
                {
                    id: 2,
                    is_from_me: false,
                    text: "Salom",
                    time: `18 : 10`,
                },
            ]  
        },
        {
            id: 8,
            first_name: "Shahzoda",
            activity: "online",
            avatar: "./img/shahzoda_kottasi.jpg",
            phone_number: "+998 90 175 08 61",
            bio: "",
            user_name: "",
            photos: 34,
            videos: 0,
            files: 18,
            audio_files: 0,
            shared_links: 4,
            voice_messages: 104,
            gifs: 13,
            groups_common: 11,
            selected:false,
            messages: [
                {
                    id: 1,
                    is_from_me: false,
                    text: "Feruza qalesan?",
                    time: `18 : 09`,
                },
                {
                    id: 2,
                    is_from_me: true,
                    text: "Yaxshi rahmat). O'ziz tuzumisiz?",
                    time: `18 : 10`,
                },
                {
                    id: 3,
                    is_from_me: true,
                    text: "Usmon yaxshimi)",
                    time: `18 : 10`,
                },
            ]  
        },
        {
            id: 9,
            first_name: "Zarnigor",
            activity: "last seen today at 21:57",
            avatar: "./img/zarnigor.jpg",
            phone_number: "+998 88 988 01 00",
            bio: "Ilahi anta maqsudi va rizaka matlubi",
            user_name: "",
            photos: 1,
            videos: 0,
            files: 0,
            audio_files: 0,
            shared_links: 0,
            voice_messages: 2,
            gifs: 0,
            groups_common: 10,
            selected:false,
            messages: [
                {
                    id: 1,
                    is_from_me: true,
                    text: "Nigor toshkenga qachon kelasan?",
                    time: `18 : 09`,
                },
                {
                    id: 2,
                    is_from_me: true,
                    text: "O'qisham boshlanadi 6-sentabrdan",
                    time: `18 : 10`,
                },
                {
                    id: 3,
                    is_from_me: false,
                    text: "Ertaga yo'lga chiqaman)",
                    time: `18 : 10`,
                },
            ]  
        },
        {
            id: 10,
            first_name: "Xolam",
            activity: "last seen recently",
            avatar: "./img/holam.jpg",
            phone_number: "hidden",
            bio: "",
            user_name: "",
            photos: 17,
            videos: 0,
            files: 1,
            audio_files: 0,
            shared_links: 0,
            voice_messages: 0,
            gifs: 0,
            groups_common: 1,
            selected:false,
            messages: [
                {
                    id: 1,
                    is_from_me: true,
                    text: "Assalomu alaykum",
                    time: `18 : 09`,
                },
                {
                    id: 2,
                    is_from_me: false,
                    text: "Vaalaykum assalom",
                    time: `18 : 10`,
                },
                {
                    id: 3,
                    is_from_me: false,
                    text: "Oyin yaxshimi?",
                    time: `18 : 10`,
                },
            ]  
        },
    ],

    me: {
           profil_name: "Feruzabonu",
           activity: "online",
           avatar: "./img/profil.png",
           phone_number: "+998 93 529 82 92",
    },

    stickers:[
        {
         
          s1:"üòÖ", 
          s2:"üòä", 
          s3:"üòê", 
          s4:"üòÇ", 
          s5:"üßê", 
          s6:"üòÅ", 
          s7:"üôä", 
          s8:"üòò", 
        },
        {
            
            s1:"üòÖ", 
            s2:"üòä", 
            s3:"üòê", 
            s4:"üòÇ", 
            s5:"üßê", 
            s6:"üòÅ", 
            s7:"üôä", 
            s8:"üòò", 
          }
    ]
}

// ===================get Elements=================

let Icons = document.querySelectorAll("i");
let userInfo = document.querySelector(".user-info");
let chat = document.querySelector(".chat");
let userInfModal = document.querySelector(".user-info-modal");
let upDownUl = document.querySelector(".up-down-ul");
let upDown = document.querySelector(".up-down");
let hidden = document.querySelector(".hidden");
let settingLi = document.querySelector(".setting_li");
let settings = document.querySelector(".settings");
let userslistNav = document.querySelector(".users-list-nav");
let humburger = document.querySelector(".humburger");
let modal_3 = document.querySelector(".modal_3");
let modal_2 = document.querySelector(".modal_2");
let modal_1 = document.querySelector(".modal_1");
let users = document.querySelector(".users");
let sendI = document.querySelector(".send_i");
let search = document.querySelector(".search");




                          // ========================== Main Part ==================================

// ================ Set t0 localStorage =====================

if(!window.localStorage.getItem("DATA")){
    window.localStorage.setItem('DATA', JSON.stringify(DATA));
    DATA = window.localStorage.getItem("DATA");
    DATA = JSON.parse(DATA) 
}


else{
    DATA = window.localStorage.getItem("DATA");
    DATA = JSON.parse(DATA)
}


// ================== Create People ===================

function userList(){
    users.innerHTML = "";
 
    DATA.users.forEach(function(user){
       
        user.messages.forEach(function(el){
            
            if(el.id==user.messages.length){
                let newuser = `<ul class="user" active="${user.id}" ><li><div class="user-list-info"> <img src=${user.avatar} alt="foto"><div><h4>${user.first_name}</h4><span style="color: #419FD9">${el.is_from_me? "You": user.first_name} : </span>
                <span>${el.text.slice(0,20)}...</span></div></div></li>
            <li><p>${el.time}</p></ul></li>`;
            users.innerHTML += newuser; 
            }     
        }) 
    })
  
   
}
userList();

let user = document.querySelectorAll("ul.user");
let messageElement = document.querySelector(".message");
let person = document.querySelector(".person");
let form = document.querySelector("form");
let write = document.querySelector(".write");
let send = document.querySelector(".send");

// ===================== Create Messages =================


function renderMessage(){
    DATA.users.forEach(function(item,key){
        if(item.selected){
            messageElement.innerHTML = "";
            
            item.messages.forEach(function(mes,id){
                let newMessage = `<li class = "${mes.is_from_me? "from-me":"to-me"}" id = "message${mes.id}">${mes.text}<p>${mes.time}</p></li>`
                messageElement.innerHTML += newMessage;
                
                person.firstElementChild.textContent = `${item.first_name}`;
                person.lastElementChild.textContent = `${item.activity}`;
                let modal_1_header = document.querySelector(".modal_1_header");
                let modal_1_body1 = document.querySelector(".modal_1_body1");
                let information = document.querySelectorAll(".information");
                let informations = document.querySelectorAll(".informations");
                let user_1_header = document.querySelector(".user_1_header");
                let user_1_body1 = document.querySelector(".user_1_body1");

                modal_1_header.firstElementChild.lastElementChild.firstElementChild.textContent = `${item.first_name}`;
                modal_1_header.firstElementChild.lastElementChild.lastElementChild.textContent = `${item.activity}`;
                modal_1_header.firstElementChild.firstElementChild.firstElementChild.setAttribute("src",`${item.avatar}`) ; 
                modal_1_body1.firstElementChild.lastElementChild.firstElementChild.textContent = `${item.phone_number}`;
               
                information[0].innerText = item.photos + " photos";
                information[1].innerText = item.videos + " videos";
                information[2].innerText = item.files + " files";
                information[3].innerText = item.audio_files + " audio files";
                information[4].innerText = item.shared_links + " shared links";
                information[5].innerText = item.voice_messages + " voice messages";
                information[6].innerText = item.gifs + " gifs";
                information[7].innerText = item.groups_common + " groups in common";

                user_1_header.firstElementChild.lastElementChild.firstElementChild.textContent = `${item.first_name}`;
                user_1_header.firstElementChild.lastElementChild.lastElementChild.textContent = `${item.activity}`;
                user_1_header.firstElementChild.firstElementChild.firstElementChild.setAttribute("src",`${item.avatar}`) ; 
                user_1_body1.firstElementChild.lastElementChild.firstElementChild.textContent = `${item.phone_number}`;

                informations[0].innerText = item.photos + " photos";
                informations[1].innerText = item.videos + " videos";
                informations[2].innerText = item.files + " files";
                informations[3].innerText = item.audio_files + " audio files";
                informations[4].innerText = item.shared_links + " shared links";
                informations[5].innerText = item.voice_messages + " voice messages";
                informations[6].innerText = item.gifs + " gifs";
                informations[7].innerText = item.groups_common + " groups in common";
            })
            
        }
        
    })
   
}



    renderMessage() 

// =================== Find selected person ============


    user.forEach(function(people,id){
        people.addEventListener("click",function(e){
            e.preventDefault()
            console.log(e)
           let active = people.getAttribute("active");
           active-=0;
           DATA.users.forEach(function(item,key){
               if((key+1)==active){
                   item.selected = true
               }else{
                   item.selected = false
               }
           })
    
           window.localStorage.setItem("DATA", JSON.stringify(DATA))
    
           renderMessage()
    
          
        })
        
    })




// =============== Send new message ============

form.addEventListener("submit",function(e){

    let text = write.value;
    if(text){
       
        DATA.users.forEach(function(item){
            if(item.selected){
                item.messages.push({
                    id: item.messages.length+1,
                    is_from_me: true,
                    text: text,
                    time: `${new Date().getHours()}  :   ${new Date().getMinutes()}`,
                })
                window.localStorage.setItem("DATA", JSON.stringify(DATA));
                renderMessage();
             write.value = "";
            }
        }  
        )
}})


sendI.addEventListener("click",function(e){
    let text = write.value;
    if(text){
        DATA.users.forEach(function(item){
            if(item.selected){
                item.messages.push({
                    id: item.messages.length+1,
                    is_from_me: true,
                    text: text,
                    time: `${new Date().getHours()}  :   ${new Date().getMinutes()}`,
                })
                window.localStorage.setItem("DATA", JSON.stringify(DATA));
                renderMessage();
             write.value = "";
            }
        } 
        )
}
})

// ============== Search ===============

search.addEventListener("input", function(e){
    e.preventDefault()
    let query = e.target.value.toLowerCase();
    let searchedList = document.querySelectorAll(".user");
    searchedList.forEach(function(searched){
        const myArray = searched.innerText.split("\n");
        myArray[0]=myArray[0].toLowerCase();
        if(myArray[0].indexOf(query) != -1){
            searched.style.display = "flex";
        }else{
            searched.style.display = "none"
        }
    })
})

search.addEventListener("input", function(e){
    e.preventDefault()
    search.style.color = "#000";
})

// =================== Sticker Btn ============
let stickerBtn = document.querySelector(".sticker-btn");
let sticker = document.querySelector(".sticker");
let icons = document.querySelectorAll(".icon");
let select = document.querySelector(".select");
let sendBtn = document.querySelector(".send-btn");
let stickerBody = document.querySelector(".sticker-body");

function renderSticker(){
   console.log(DATA.stickers[0])
    DATA.stickers.forEach(function(sticker,key){
        console.log(key)
            stickerBody.innerHTML+=`<ul><li>${sticker.s1}</li></ul>`;

     
       
    })
}

renderSticker()



                         // ========================== additional elements ===========================



// =================== Show send icon ==============

write.addEventListener("input", function(e){
        form.lastElementChild.style.display = "flex";
})


// ================ Open and Close user Info =================

for (let el of Icons){
   let check = false;
  
   el.addEventListener("click", function(e){
    
    if(el.className !== "fas fa-times exit_search"){

        el.style.backgroundColor = "#E7E7E7";
        setTimeout(function(){el.style.backgroundColor = "#fff"},200);
        if((el.className == "fas fa-columns") && (check===false)){
        userInfo.style.display = "inline-block";
        chat.style.width = "850px"
        check = true;
        el.style.color = "#168ACD";
     }
     else{
         userInfo.style.display = "none";
         check = false;
         el.style.color = "#A8A8A8";
         chat.style.width = "1150px"
      }
      if(check){
         for(let el of Icons){
             el.addEventListener("click", function(e){
                 if((el.className == "fas fa-times")){
                     userInfo.style.display = "none";
                     chat.style.width = "1150px"
                     for(let el of Icons){
                         el.className === "fas fa-columns"?el.style.color = "#A8A8A8":""
                      }
                      check = false;
                  }
             })
         }
     }
    }
     
   }) 
}

// ================Open and Close user Info Modal=================

person.addEventListener("click",function(e){
    userInfModal.style.display = "flex"
})
 
let clickCheck_1 = false;

modal_1.addEventListener("click", function(e){
    clickCheck_1 = true
  })
  
  userInfModal.addEventListener("click", function(e){
      if(!clickCheck_1){
          userInfModal.style.display = "none"
      }else{
          clickCheck_1 = false
      }
  })

for(let el of Icons){
    el.addEventListener("click", function(e){
        if((el.className == "fas fa-times")){
           setTimeout(function(){userInfModal.style.display = "none"},100)
         }
    })
}



// ================== Open and Close Humburgar Modal , up-down btn ===============

userslistNav.firstElementChild.addEventListener("click", function(e){
    humburger.style.display = "flex"
})

let clickCheck_2 = false;

modal_2.addEventListener("click", function(e){
    clickCheck_2 = true
  })
  
  humburger.addEventListener("click", function(e){
      if(!clickCheck_2){
          humburger.style.display = "none"
      }else{
          clickCheck_2 = false
      }
  })

upDownUl.addEventListener("click", function(e){
    upDown.firstChild.style.backgroundColor = "none";
    if(upDown.firstChild.className === "fas fa-chevron-down"){
        upDown.firstChild.className = "fas fa-chevron-up";
        hidden.style.display = "inline-block"
    }else{
        upDown.firstChild.className = "fas fa-chevron-down";
        hidden.style.display = "none"
    }
    upDown.firstChild.addEventListener("click",function(e){
        upDown.firstChild.style.backgroundColor = "none"
        console.log(e.target.style.backgroundColor)
    })

})

modal_2.firstElementChild.firstElementChild.firstElementChild.firstElementChild.setAttribute("src", `${DATA.me.avatar}`);
upDownUl.firstElementChild.firstElementChild.textContent = `${DATA.me.profil_name}`;
upDownUl.firstElementChild.lastElementChild.textContent = `${DATA.me.phone_number}`;
hidden.firstElementChild.firstElementChild.firstElementChild.setAttribute("src", `${DATA.me.avatar}`);
hidden.firstElementChild.lastElementChild.firstElementChild.textContent = `${DATA.me.profil_name}`



// ================== Open and Close Settings Modal ===============

settingLi.addEventListener("click", function(e){
    humburger.style.display = "none";
    settings.style.display = "flex";
})
for(let el of Icons){
    el.addEventListener("click", function(e){
        if((el.className == "fas fa-times")){
           setTimeout(function(){settings.style.display = "none"},100)
         }
    })
}

let clickCheck_3 = false;

modal_3.addEventListener("click", function(e){
  clickCheck_3 = true
})

settings.addEventListener("click", function(e){
    if(!clickCheck_3){
        settings.style.display = "none"
    }else{
        clickCheck_3 = false
    }

  
})

let modal_3_header = document.querySelector(".modal_3_header");
modal_3_header.firstElementChild.lastElementChild.firstElementChild.textContent = `${DATA.me.profil_name}`;
modal_3_header.firstElementChild.lastElementChild.lastElementChild.textContent = `${DATA.me.activity}`;
modal_3_header.firstElementChild.firstElementChild.firstElementChild.setAttribute("src",`${DATA.me.avatar}`) ;